<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>HWA: _swuarta</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extrastylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HWA
   </div>
   <div id="projectbrief">HardWare Abstractor</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('atmelavr_swuarta.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">_swuarta </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Class <code>_swuarta</code> implements a software UART for 1 or 2-wire communication with automatic baudrate detection capability.</p>
<p><code>_swuarta</code> can work with an 8 or 16-bit counter. It can use any pin that provides a pin-change interrupt.</p>
<p>Tested on ATtinyX4 with internal oscillator (~8 MHz):</p>
<ul>
<li>1200..115200 bps with 16-bit timer not prescaled</li>
<li>450.. 50000 bps with 16-bit timer 1/8 prescaled</li>
<li>38400..115200 bps with 8-bit timer not prescaled</li>
<li>10000 bps with 8-bit timer 1/8 prescaled</li>
</ul>
<dl class="section user"><dt>Compile-time configuration</dt><dd></dd></dl>
<p>Note: the naming of these symbols will change in the future to suit HWA object-oriented style better.</p>
<p>For efficiency reasons, a large part of the configuration must be defined at compile time. The following symbols must be defined in your project.</p>
<table class="doxtable">
<tr>
<th align="left">Symbol </th><th align="left">Example </th><th align="left">Comment  </th></tr>
<tr>
<td align="left"><code>HW_SWUART0_PIN_TX</code> </td><td align="left">hw_pin_pa0 </td><td align="left">Pin used for TXD </td></tr>
<tr>
<td align="left"><code>HW_SWUART0_PIN_RX</code> </td><td align="left">hw_pin_5 </td><td align="left">Pin used for RXD </td></tr>
<tr>
<td align="left"><code>HW_SWUART0_AUTOSYNC</code> </td><td align="left">5_1<br/>
10_1 </td><td align="left">Synchronization method </td></tr>
<tr>
<td align="left"><code>HW_SWUART0_COUNTER</code> </td><td align="left">hw_counter0<br/>
hw_counter1 </td><td align="left">Counter used </td></tr>
<tr>
<td align="left"><code>HW_SWUART0_COUNTER_CLK_DIV</code> </td><td align="left">1<br/>
8 </td><td align="left">Counter clock division (of <code>hw_syshz</code>) </td></tr>
<tr>
<td align="left"><code>HW_SWUART0_COUNTER_MATCH</code> </td><td align="left">compare0<br/>
compare1 </td><td align="left">Compare unit used for bit timing </td></tr>
<tr>
<td align="left"><code>HW_SWUART0_PIN_DBG</code> </td><td align="left">hw_pin_6 </td><td align="left">Pin used for debugging </td></tr>
</table>
<p>If <code>HW_SWUART0_PIN_TX</code> and <code>HW_SWUART0_PIN_TX</code> are the same, the UART will revert to RX mode after transmission is completed and transmission will be delayed until reception is completed.<br/>
</p>
<p>Pin-change IRQs associated to <code>HW_SWUART0_PIN_TX</code> are serviced by the UART. This implies that the same pin-change vector can not be used by the application.</p>
<p><code>HW_SWUART0_PIN_DBG</code> is usefull only for debugging the implementation of the UART and should be left undefined.</p>
<dl class="section user"><dt>Automatic baudrate detection</dt><dd></dd></dl>
<ul>
<li>The <code>5_1</code> method waits for a sequence of 5 low-level bits followed by 1 low-level bit. The ASCII character 'A' will do that.</li>
<li>The <code>10_1</code> method waits for a sequence of 10 low-level bits followed by 1 low-level bit. This is done by sending a break byte of 10 low-level bits followed by a 0xFF byte.</li>
</ul>
<p>Leave <code>HW_SWUART0_AUTOSYNC</code> undefined if you do not need this feature.</p>
<dl class="section user"><dt>Run-time configuration</dt><dd></dd></dl>
<div class="fragment"><div class="line">hwa_config(  UART,</div>
<div class="line">            [baudrate, BAUDRATE ]</div>
<div class="line">          );</div>
</div><!-- fragment --><dl class="section user"><dt>Read one byte from UART</dt><dd></dd></dl>
<div class="fragment"><div class="line">uint8_t byte = hw_read( UART );</div>
</div><!-- fragment --><dl class="section user"><dt>Write one byte into UART</dt><dd></dd></dl>
<div class="fragment"><div class="line">hw_write( UART, <span class="charliteral">&#39;#&#39;</span> );</div>
</div><!-- fragment --><dl class="section user"><dt>Get the status of the UART</dt><dd></dd></dl>
<div class="fragment"><div class="line">uint8_t byte ;</div>
<div class="line">hw_stat_t( UART ) st ;       <span class="comment">// Structure of UART status</span></div>
<div class="line">st = hw_stat( UART );        <span class="comment">// Read the status</span></div>
<div class="line">if ( st.rxc )                <span class="comment">// Reception complete?</span></div>
<div class="line">  byte = hw_read( UART );</div>
</div><!-- fragment --><dl class="section user"><dt>Reset the UART</dt><dd></dd></dl>
<p>This will abort any transmission or reception. If the UART has automatic baudrate detection, the UART will resynchronize.</p>
<div class="fragment"><div class="line">hw_reset( UART );</div>
</div><!-- fragment --><p><br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
